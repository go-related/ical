package ical

import (
	"context"
	"github.com/stretchr/testify/assert"
	"strings"
	"testing"
	"time"
)

func Test_Expand_Daily(t *testing.T) {
	tests := []struct {
		name           string
		ics            string
		start          time.Time
		end            time.Time
		expectedResult []Event
	}{{
		name: "verify_empty",
		ics:  "",
	}, {
		name: "very_parsing_one_event",
		ics: `BEGIN:VCALENDAR
				BEGIN:VEVENT
				DTSTAMP:20181116T133227Z
				DTSTART;TZID=Europe/Paris:20190101T090000
				DTEND;TZID=Europe/Paris:20190101T110000
				UID:one@gocal
				SUMMARY:Event1
				X-ROOMID:128-132P
				X-COLOR:#000000
				END:VEVENT
				END:VCALENDAR
				`,
		expectedResult: []Event{
			{
				Summary: "Event1",
				Uid:     "one@gocal",
				Start:   newDatePtr(2019, 1, 1, 9, 0, 0, 0, parseLocation("Europe/Paris")),
				End:     newDatePtr(2019, 1, 1, 10, 0, 0, 0, parseLocation("Europe/Paris")),
			},
		},
	}}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			gc := NewParser(strings.NewReader(tt.ics))
			gc.Start = &tt.start
			gc.End = &tt.end
			err := gc.Parse(context.Background())

			assert.Nil(t, err)
			assert.Equal(t, len(tt.expectedResult), len(gc.events))
			for counter, eventData := range tt.expectedResult {
				assert.Equal(t, tt.expectedResult[counter], eventData)
			}
		})
	}
	//	sampleIcs := `
	//BEGIN:VCALENDAR
	//PRODID:-//Google Inc//Google Calendar 70.9054//EN
	//VERSION:2.0
	//CALSCALE:GREGORIAN
	//METHOD:PUBLISH
	//X-WR-CALNAME:Church
	//X-WR-TIMEZONE:America/New_York
	//BEGIN:VTIMEZONE
	//TZID:America/Scoresbysund
	//X-LIC-LOCATION:America/Scoresbysund
	//BEGIN:STANDARD
	//TZOFFSETFROM:-0100
	//TZOFFSETTO:-0200
	//TZNAME:-02
	//DTSTART:19701025T000000
	//RRULE:FREQ=YEARLY;BYMONTH=10;BYDAY=-1SU
	//END:STANDARD
	//BEGIN:DAYLIGHT
	//TZOFFSETFROM:-0200
	//TZOFFSETTO:-0100
	//TZNAME:-01
	//DTSTART:19700328T230000
	//RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=-1SA
	//END:DAYLIGHT
	//END:VTIMEZONE
	//BEGIN:VTIMEZONE
	//TZID:America/New_York
	//X-LIC-LOCATION:America/New_York
	//BEGIN:DAYLIGHT
	//TZOFFSETFROM:-0500
	//TZOFFSETTO:-0400
	//TZNAME:EDT
	//DTSTART:19700308T020000
	//RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=2SU
	//END:DAYLIGHT
	//BEGIN:STANDARD
	//TZOFFSETFROM:-0400
	//TZOFFSETTO:-0500
	//TZNAME:EST
	//DTSTART:19701101T020000
	//RRULE:FREQ=YEARLY;BYMONTH=11;BYDAY=1SU
	//END:STANDARD
	//END:VTIMEZONE
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20230114T080000
	//DTEND;TZID=America/New_York:20230114T093000
	//RRULE:FREQ=MONTHLY;BYDAY=2SA
	//EXDATE;TZID=America/New_York:20230311T080000
	//EXDATE;TZID=America/New_York:20230408T080000
	//EXDATE;TZID=America/New_York:20230513T080000
	//EXDATE;TZID=America/New_York:20231209T080000
	//EXDATE;TZID=America/New_York:20240309T080000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast & Deacon's Meeting
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20230114T080000
	//DTEND;TZID=America/New_York:20230114T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20230114T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20230211T080000
	//DTEND;TZID=America/New_York:20230211T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20230211T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20230610T080000
	//DTEND;TZID=America/New_York:20230610T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20230610T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20230708T080000
	//DTEND;TZID=America/New_York:20230708T090000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20230708T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20230812T080000
	//DTEND;TZID=America/New_York:20230812T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20230812T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20230909T080000
	//DTEND;TZID=America/New_York:20230909T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20230909T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20231111T080000
	//DTEND;TZID=America/New_York:20231111T090000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20231111T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230504T115929Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20240907T080000
	//DTEND;TZID=America/New_York:20240907T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20240914T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230807T155058Z
	//SEQUENCE:1
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast & Deacon's Meeting
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20231007T080000
	//DTEND;TZID=America/New_York:20231007T090000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20231014T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230807T201221Z
	//SEQUENCE:2
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20240406T080000
	//DTEND;TZID=America/New_York:20240406T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20240413T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20230809T142056Z
	//SEQUENCE:1
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast & Deacon's Meeting
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20241005T080000
	//DTEND;TZID=America/New_York:20241005T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20241012T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20231023T200728Z
	//SEQUENCE:1
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast & Deacon's Meeting
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20240210T080000
	//DTEND;TZID=America/New_York:20240210T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20240210T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20231127T190232Z
	//SEQUENCE:0
	//STATUS:CONFIRMED
	//SUMMARY:Combined Men's and Ladies' Breakfast & Bible Study/Deacon's Meeting
	//
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20240615T080000
	//DTEND;TZID=America/New_York:20240615T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20240608T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20240131T135809Z
	//SEQUENCE:1
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast & Deacon's Meeting
	//TRANSP:OPAQUE
	//END:VEVENT
	//BEGIN:VEVENT
	//DTSTART;TZID=America/New_York:20241207T080000
	//DTEND;TZID=America/New_York:20241207T093000
	//DTSTAMP:20240207T084931Z
	//UID:3ffa1v862i9na5ess0htnh6t09@google.com
	//RECURRENCE-ID;TZID=America/New_York:20241214T080000
	//CREATED:20220616T131002Z
	//LAST-MODIFIED:20240205T184231Z
	//SEQUENCE:1
	//STATUS:CONFIRMED
	//SUMMARY:Men's Breakfast & Deacon's Meeting
	//TRANSP:OPAQUE
	//END:VEVENT
	//END:VCALENDAR
	//`
}
